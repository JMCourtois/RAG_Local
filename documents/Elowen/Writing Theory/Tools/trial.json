{"nodes":[{"parameters":{},"id":"trigger","name":"Manual Trigger","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,200]},{"parameters":{"operation":"download","fileId":"YOUR_CHARACTER_MD_FILE_ID"},"id":"downloadChar","name":"GDrive Download Character","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[500,80]},{"parameters":{"operation":"download","fileId":"YOUR_THEORY_MD_FILE_ID"},"id":"downloadTheory","name":"GDrive Download Theory","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[500,180]},{"parameters":{"operation":"download","fileId":"YOUR_TEMPLATE_MD_FILE_ID"},"id":"downloadTemplate","name":"GDrive Download Template","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[500,280]},{"parameters":{"values":[{"name":"type","value":"Character"},{"name":"updateSection","value":"Character"},{"name":"dependents","value":"Conflict,Timeline"},{"name":"outputFolderId","value":"YOUR_OUTPUT_FOLDER_ID"}]},"id":"setVars","name":"Set Params","type":"n8n-nodes-base.set","typeVersion":2,"position":[700,180]},{"parameters":{"functionCode":"const getMd=bin=>Buffer.from(bin.data,'base64').toString('utf8');\nreturn [{\n char:getMd($node['GDrive Download Character'].binary.data),\n theory:getMd($node['GDrive Download Theory'].binary.data),\n template:getMd($node['GDrive Download Template'].binary.data),\n type:$node['Set Params'].json.type,\n updateSection:$node['Set Params'].json.updateSection,\n dependents:($node['Set Params'].json.dependents||'').split(','),\n outputFolderId:$node['Set Params'].json.outputFolderId\n}];"},"id":"prepAI","name":"Prepare For AI","type":"n8n-nodes-base.function","typeVersion":2,"position":[900,180]},{"parameters":{"requestMethod":"POST","url":"https://api.deepseek.com/v1/chat/completions","jsonParameters":true,"options":{},"bodyParametersJson":"{\"model\":\"deepseek-chat\",\"messages\":[{\"role\":\"system\",\"content\":\"You are an expert writing assistant. Receive a markdown file with sections, a writing theory (markdown), and a template (markdown). Based on the theory and template, generate or expand the section '{{updateSection}}' and all its dependents ({{dependents}}) for a new {{type}}. Output only the new markdown file with all relevant information.\"},{\"role\":\"user\",\"content\":\"Character:\\n{{char}}\\n\\nWriting Theory:\\n{{theory}}\\n\\nTemplate:\\n{{template}}\\n\\nSection to create: {{updateSection}}\\nDependent sections: {{dependents}}\"}],\"stream\":false}","headers":[{"name":"Authorization","value":"Bearer YOUR_DEEPSEEK_API_KEY"},{"name":"Content-Type","value":"application/json"}]},"id":"ai","name":"DeepSeek Chat","type":"n8n-nodes-base.httpRequest","typeVersion":2,"position":[1100,180]},{"parameters":{"functionCode":"const text=$json.choices?.[0]?.message?.content||'';\nconst now=new Date();\nconst pad=x=>String(x).padStart(2,'0');\nconst fname=`${$json.type||'file'}-${pad(now.getMonth()+1)}-${pad(now.getDate())}-${pad(now.getHours())}-${pad(now.getMinutes())}.md`;\nreturn [{binary:{data:Buffer.from(text,'utf8').toString('base64')},json:{filename:fname,outputFolderId:$json.outputFolderId}}];"},"id":"createFilename","name":"Create Filename","type":"n8n-nodes-base.function","typeVersion":2,"position":[1300,180]},{"parameters":{"operation":"upload","binaryPropertyName":"data","fileName":"={{$json.filename}}","parentFolderId":"={{$json.outputFolderId}}"},"id":"gdriveUpload","name":"GDrive Upload","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1500,180]}],"connections":{"Manual Trigger":["GDrive Download Character","GDrive Download Theory","GDrive Download Template"],"GDrive Download Character":["Prepare For AI"],"GDrive Download Theory":["Prepare For AI"],"GDrive Download Template":["Prepare For AI"],"Set Params":["Prepare For AI"],"Prepare For AI":["DeepSeek Chat"],"DeepSeek Chat":["Create Filename"],"Create Filename":["GDrive Upload"]},"active":false,"settings":{},"meta":{}}
